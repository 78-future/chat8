# 日志输出优化说明

## 优化概述

为了改善开发体验和减少控制台噪音，我们对应用的日志输出进行了全面优化，移除了大量冗余的调试信息，只保留关键的错误和状态变化信息。

## 优化的文件和内容

### 1. HybridMessaging.js
**优化内容：**
- 移除了WebSocket连接建立和断开时的详细状态同步日志
- 精简了P2P连接建立过程中的冗余输出
- 移除了ICE候选发送、Offer发送等详细步骤日志
- 保留了重要的错误信息和警告
- 移除了预连接过程中的详细状态日志

**保留的关键日志：**
- WebSocket连接成功/失败
- P2P连接失败的错误信息
- 状态同步失败的警告

### 2. HybridChatWindow.vue
**优化内容：**
- 移除了图片路径处理的详细调试信息
- 移除了"=== 图片路径处理开始/结束 ==="等冗余标记
- 保留了关键的错误处理

### 3. hybrid-store.js
**优化内容：**
- 移除了用户状态变化的详细处理日志
- 移除了P2P状态变化的详细记录
- 保留了错误处理逻辑

### 4. HybridChatMain.vue
**优化内容：**
- 移除了联系人预连接过程的详细日志
- 保留了P2P连接成功的用户通知
- 简化了错误处理逻辑

## 新增功能

### Logger 工具类
创建了 `src/utils/logger.js` 文件，提供统一的日志管理：

```javascript
import Logger from '@/utils/logger.js';

Logger.error('错误信息');   // 总是显示
Logger.warn('警告信息');    // 默认显示
Logger.info('普通信息');    // 需要设置INFO级别
Logger.debug('调试信息');   // 需要设置DEBUG级别
```

### 环境变量控制
可以通过 `.env` 文件控制日志级别：

```env
# 只显示错误
VITE_LOG_LEVEL=ERROR

# 显示警告和错误（默认）
VITE_LOG_LEVEL=WARN

# 显示信息、警告和错误
VITE_LOG_LEVEL=INFO

# 显示所有日志（开发调试用）
VITE_LOG_LEVEL=DEBUG
```

## 优化效果

### 优化前的问题：
- 控制台输出过于冗余，难以定位关键信息
- 大量重复的状态变化日志
- 图片处理等常规操作产生过多调试信息
- P2P连接过程的每个步骤都有详细日志

### 优化后的改进：
- 控制台输出大幅减少，只显示关键信息
- 保留了所有重要的错误和警告信息
- 移除了正常操作流程中的冗余日志
- 提供了灵活的日志级别控制机制

## 使用建议

### 生产环境
建议设置 `VITE_LOG_LEVEL=ERROR`，只显示错误信息。

### 开发环境
- 日常开发：使用默认的 `WARN` 级别
- 调试特定功能：临时设置为 `INFO` 或 `DEBUG` 级别
- 排查问题：设置为 `DEBUG` 级别查看详细信息

### 未来扩展
如果需要恢复某些调试信息，可以：
1. 使用 Logger 工具类替换 console.log
2. 根据功能模块设置不同的日志级别
3. 添加更细粒度的日志控制（如按模块控制）

## 兼容性说明

- 所有现有功能保持不变
- 错误处理逻辑完全保留
- 用户体验没有任何影响
- 只是减少了开发者控制台的信息量

这次优化显著改善了开发体验，让开发者能够更容易地关注到真正重要的信息，同时保持了完整的错误处理和调试能力。